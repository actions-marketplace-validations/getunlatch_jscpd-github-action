"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs_extra_1 = require("fs-extra");
const rimraf = require("rimraf");
const level = require('level');
class LevelDbStore {
    constructor() {
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        this.dbs = {};
    }
    get(key) {
        return this.dbs[this.name].get(key).then((value) => JSON.parse(value));
    }
    namespace(name) {
        this.name = name;
        if (!(name in this.dbs)) {
            const path = `.jscpd/${name}`;
            rimraf.sync(path);
            fs_extra_1.ensureDirSync(path);
            this.dbs[name] = level(path);
        }
    }
    set(key, value) {
        return this.dbs[this.name].put(key, JSON.stringify(value));
    }
    close() {
        Object.entries(this.dbs).forEach(([name, db]) => {
            db.close(() => {
                rimraf('.jscpd/' + name, { maxBusyTries: 10 }, (err) => {
                    if (err) {
                        console.log(err);
                    }
                });
            });
        });
        rimraf.sync('.jscpd');
    }
}
exports.default = LevelDbStore;
//# sourceMappingURL=index.js.map